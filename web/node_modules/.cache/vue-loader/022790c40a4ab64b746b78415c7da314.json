{"remainingRequest":"D:\\postgraduate\\高中数学课程\\高级软工\\wego\\web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\postgraduate\\高中数学课程\\高级软工\\wego\\web\\src\\views\\chat.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\postgraduate\\高中数学课程\\高级软工\\wego\\web\\src\\views\\chat.vue","mtime":1697877337559},{"path":"D:\\postgraduate\\高中数学课程\\高级软工\\wego\\web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\postgraduate\\高中数学课程\\高级软工\\wego\\web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\postgraduate\\高中数学课程\\高级软工\\wego\\web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\postgraduate\\高中数学课程\\高级软工\\wego\\web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmV4cG9ydCBkZWZhdWx0IHsKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgd3M6IG51bGwsCiAgICAgIGNvdW50OiAwLAogICAgICAvLyB1c2VySWQ6IHRoaXMuJHN0b3JlLmdldHRlcnMuaWQsIC8vIOW9k+WJjeeUqOaIt0lECiAgICAgIC8vIHVzZXJuYW1lOiB0aGlzLiRzdG9yZS5nZXR0ZXJzLm5hbWUsIC8vIOW9k+WJjeeUqOaIt+aYteensAogICAgICAvLyBhdmF0YXI6IHRoaXMuJHN0b3JlLmdldHRlcnMuYXZhdGFyLCAvLyDlvZPliY3nlKjmiLflpLTlg48KICAgICAgbGlzdDogW10sIC8vIOiBiuWkqeiusOW9leeahOaVsOe7hAogICAgICBjb250ZW50VGV4dDogIiIsIC8vIGlucHV06L6T5YWl55qE5YC8CiAgICAgIHVzZXJJZDogMCwKICAgICAgbXlVc2VySWQ6IDAKICAgIH07CiAgfSwKICBtb3VudGVkKCkgewogICAgICBjb25zb2xlLmxvZyh0aGlzLiRyb3V0ZS5wYXJhbXMpCiAgICAgIHRoaXMudXNlcklkID0gdGhpcy4kcm91dGUucGFyYW1zLnVzZXJJZCwKICAgICAgdGhpcy5pbml0V2ViU29ja2V0KCk7CiAgICAgIHRoaXMubXlVc2VySWQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndXNlcicpCiAgICAgIGNvbnNvbGUubG9nKDEyMyx0aGlzLm15VXNlcklkKQogIH0sCgogIGRlc3Ryb3llZCgpIHsKICAgIC8vIOemu+W8gOmhtemdouaXtuWFs+mXrXdlYnNvY2tldOi/nuaOpQogICAgdGhpcy53cy5vbmNsb3NlKHVuZGVmaW5lZCk7CiAgfSwKICBtZXRob2RzOiB7CiAgICAvLyDlj5HpgIHogYrlpKnkv6Hmga8KICAgIHNlbmRUZXh0KCkgewogICAgICBsZXQgX3RoaXMgPSB0aGlzOwogICAgICBfdGhpcy4kcmVmc1sic2VuZE1zZyJdLmZvY3VzKCk7CiAgICAgIGlmICghX3RoaXMuY29udGVudFRleHQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgbGV0IHBhcmFtcyA9IHsKICAgICAgICB0b0lkOiBfdGhpcy51c2VySWQsCiAgICAgICAgbWVzc2FnZUNvbnRlbnQ6IF90aGlzLmNvbnRlbnRUZXh0LAogICAgICAgIGZyb21JZDogX3RoaXMubXlVc2VySWQsCiAgICAgIH07CiAgICAgIF90aGlzLndzLnNlbmQoSlNPTi5zdHJpbmdpZnkocGFyYW1zKSk7IC8v6LCD55SoV2ViU29ja2V0IHNlbmQoKeWPkemAgeS/oeaBr+eahOaWueazlQogICAgICBfdGhpcy5saXN0LnB1c2gocGFyYW1zKQogICAgICBfdGhpcy5jb250ZW50VGV4dCA9ICIiOwogICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICBfdGhpcy5zY3JvbGxCb3R0bSgpOwogICAgICB9LCA1MDApOwogICAgfSwKICAgIC8vIOi/m+WFpemhtemdouWIm+W7undlYnNvY2tldOi/nuaOpQogICAgaW5pdFdlYlNvY2tldCgpIHsKICAgICAgbGV0IF90aGlzID0gdGhpczsKICAgICAgLy8g5Yik5pat6aG16Z2i5pyJ5rKh5pyJ5a2Y5Zyod2Vic29ja2V06L+e5o6lCiAgICAgIGlmICh3aW5kb3cuV2ViU29ja2V0KSB7CiAgICAgICAgLy92YXIgc2VydmVySG90ID0gIHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZTsKICAgICAgICAvL2xldCBzaXAgPSAn5oi/6Ze05Y+3JwogICAgICAgIC8vIOWhq+WGmeacrOWcsElQ5Zyw5Z2AIOatpOWkhOeahCA6OTEwMeerr+WPo+WPtyDopoHkuI7lkI7nq6/phY3nva7nmoTkuIDoh7TvvIEKICAgICAgICAvL3ZhciB1cmwgPSAnd3M6Ly8nICsgc2VydmVySG90ICsgJzo5MTAxJyArICcvZ3JvdXBDaGF0LycgKyBzaXAgKyAnLycgKyB0aGlzLnVzZXJJZDsgLy8gYHdzOi8vMTI3LjAuMC4xLzkxMDEvZ3JvdXBDaGF0LzEwMDg2L+iBiuWkqeWupGAKICAgICAgICAvL3RoaXMud2Vic29ja2V0ID0gbmV3IFdlYlNvY2tldChgd3M6Ly9sb2NhbGhvc3Q6ODA4MS8ke2lkfWApOwogICAgICAgIGxldCB1cmwgPSBgd3M6Ly9sb2NhbGhvc3Q6ODA4MS9jaGF0LyR7X3RoaXMudXNlcklkfWA7CiAgICAgICAgbGV0IHdzID0gbmV3IFdlYlNvY2tldCh1cmwpOwogICAgICAgIF90aGlzLndzID0gd3M7CiAgICAgICAgd3Mub25vcGVuID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgY29uc29sZS5sb2coIuacjeWKoeWZqOi/nuaOpeaIkOWKnzogIiArIHVybCxlKTsKICAgICAgICAgIC8vd3Muc2VuZChfdGhpcy51c2VySWQpCiAgICAgICAgfTsKICAgICAgICB3cy5vbmNsb3NlID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgY29uc29sZS5sb2coIuacjeWKoeWZqOi/nuaOpeWFs+mXrTogIiArIHVybCxlKTsKICAgICAgICB9OwogICAgICAgIHdzLm9uZXJyb3IgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCLmnI3liqHlmajov57mjqXlh7rplJk6ICIgKyB1cmwpOwogICAgICAgIH07CiAgICAgICAgd3Mub25tZXNzYWdlID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgLy/mjqXmlLbmnI3liqHlmajov5Tlm57nmoTmlbDmja4KICAgICAgICAgIGxldCByZXNEYXRhID0gSlNPTi5wYXJzZShlLmRhdGEpCiAgICAgICAgICBjb25zb2xlLmxvZygn5o6l5pS25pWw5o2uJyxyZXNEYXRhKQogICAgICAgICAgLy8gX3RoaXMubGlzdCA9IFsKICAgICAgICAgIC8vICAgLi4uX3RoaXMubGlzdCwKICAgICAgICAgIC8vICAgeyB1c2VySWQ6IHJlc0RhdGEudXNlcklkLCB1c2VybmFtZTogcmVzRGF0YS51c2VybmFtZSwgYXZhdGFyOiByZXNEYXRhLmF2YXRhciwgY29udGVudDogcmVzRGF0YS5tc2cgfQogICAgICAgICAgLy8gXTsKICAgICAgICAgIF90aGlzLmxpc3QucHVzaChyZXNEYXRhKQogICAgICAgICAgY29uc29sZS5sb2coJ+a2iOaBr+WIl+ihqCcsX3RoaXMubGlzdCkKICAgICAgICB9OwogICAgICB9CiAgICB9LAogICAgLy8g5rua5Yqo5p2h5Yiw5bqV6YOoCiAgICBzY3JvbGxCb3R0bSgpIHsKICAgICAgICBsZXQgZWwgPSB0aGlzLiRyZWZzWyJtc2ctYm94Il07CiAgICAgICAgZWwuc2Nyb2xsVG9wID0gZWwuc2Nyb2xsSGVpZ2h0OwogICAgfQogIH0KfTsK"},{"version":3,"sources":["chat.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AA0BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"chat.vue","sourceRoot":"src/views","sourcesContent":["<template>\r\n  <div class=\"chat-box\">\r\n    <header>与{{userId}}聊天</header>\r\n    <div class=\"msg-box\" ref=\"msg-box\">\r\n      <div\r\n        v-for=\"(i,index) in list\"\r\n        :key=\"index\"\r\n        class=\"msg\"\r\n        \r\n      >\r\n        <!-- <div class=\"user-head\">\r\n          <img :src=\"i.avatar\" height=\"30\" width=\"30\" :title=\"i.username\">\r\n        </div> -->\r\n        <div class=\"user-msg\">\r\n          <span :style=\"i.toId == userId?' float: right;':''\" :class=\"i.toId == userId?'right':'left'\">{{i.messageContent}}</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"input-box\">\r\n      <input type=\"text\" ref=\"sendMsg\" v-model=\"contentText\" @keyup.enter=\"sendText()\" />\r\n      <div class=\"btn\" :class=\"{['btn-active']:contentText}\" @click=\"sendText()\">发送</div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  export default {\r\n    data() {\r\n      return {\r\n        ws: null,\r\n        count: 0,\r\n        // userId: this.$store.getters.id, // 当前用户ID\r\n        // username: this.$store.getters.name, // 当前用户昵称\r\n        // avatar: this.$store.getters.avatar, // 当前用户头像\r\n        list: [], // 聊天记录的数组\r\n        contentText: \"\", // input输入的值\r\n        userId: 0,\r\n        myUserId: 0\r\n      };\r\n    },\r\n    mounted() {\r\n        console.log(this.$route.params)\r\n        this.userId = this.$route.params.userId,\r\n        this.initWebSocket();\r\n        this.myUserId = localStorage.getItem('user')\r\n        console.log(123,this.myUserId)\r\n    },\r\n\r\n    destroyed() {\r\n      // 离开页面时关闭websocket连接\r\n      this.ws.onclose(undefined);\r\n    },\r\n    methods: {\r\n      // 发送聊天信息\r\n      sendText() {\r\n        let _this = this;\r\n        _this.$refs[\"sendMsg\"].focus();\r\n        if (!_this.contentText) {\r\n          return;\r\n        }\r\n        let params = {\r\n          toId: _this.userId,\r\n          messageContent: _this.contentText,\r\n          fromId: _this.myUserId,\r\n        };\r\n        _this.ws.send(JSON.stringify(params)); //调用WebSocket send()发送信息的方法\r\n        _this.list.push(params)\r\n        _this.contentText = \"\";\r\n        setTimeout(() => {\r\n          _this.scrollBottm();\r\n        }, 500);\r\n      },\r\n      // 进入页面创建websocket连接\r\n      initWebSocket() {\r\n        let _this = this;\r\n        // 判断页面有没有存在websocket连接\r\n        if (window.WebSocket) {\r\n          //var serverHot =  window.location.hostname;\r\n          //let sip = '房间号'\r\n          // 填写本地IP地址 此处的 :9101端口号 要与后端配置的一致！\r\n          //var url = 'ws://' + serverHot + ':9101' + '/groupChat/' + sip + '/' + this.userId; // `ws://127.0.0.1/9101/groupChat/10086/聊天室`\r\n          //this.websocket = new WebSocket(`ws://localhost:8081/${id}`);\r\n          let url = `ws://localhost:8081/chat/${_this.userId}`;\r\n          let ws = new WebSocket(url);\r\n          _this.ws = ws;\r\n          ws.onopen = function(e) {\r\n            console.log(\"服务器连接成功: \" + url,e);\r\n            //ws.send(_this.userId)\r\n          };\r\n          ws.onclose = function(e) {\r\n            console.log(\"服务器连接关闭: \" + url,e);\r\n          };\r\n          ws.onerror = function() {\r\n            console.log(\"服务器连接出错: \" + url);\r\n          };\r\n          ws.onmessage = function(e) {\r\n            //接收服务器返回的数据\r\n            let resData = JSON.parse(e.data)\r\n            console.log('接收数据',resData)\r\n            // _this.list = [\r\n            //   ..._this.list,\r\n            //   { userId: resData.userId, username: resData.username, avatar: resData.avatar, content: resData.msg }\r\n            // ];\r\n            _this.list.push(resData)\r\n            console.log('消息列表',_this.list)\r\n          };\r\n        }\r\n      },\r\n      // 滚动条到底部\r\n      scrollBottm() {\r\n          let el = this.$refs[\"msg-box\"];\r\n          el.scrollTop = el.scrollHeight;\r\n      }\r\n    }\r\n  };\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n  .chat-box {\r\n    margin: 0 auto;\r\n    background: #fafafa;\r\n    position: absolute;\r\n    height: 100%;\r\n    width: 100%;\r\n    max-width: 700px;\r\n  header {\r\n    position: fixed;\r\n    width: 100%;\r\n    height: 3rem;\r\n    background: #409eff;\r\n    max-width: 700px;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    font-weight: bold;\r\n    color: white;\r\n    font-size: 1rem;\r\n  }\r\n  .msg-box {\r\n    position: absolute;\r\n    height: calc(100% - 6.5rem);\r\n    width: 100%;\r\n    margin-top: 3rem;\r\n    overflow-y: scroll;\r\n  .msg {\r\n    width: 95%;\r\n    min-height: 2.5rem;\r\n    margin: 1rem 0.5rem;\r\n    position: relative;\r\n    display: flex;\r\n    justify-content: flex-start !important;\r\n  .user-head {\r\n    min-width: 2.5rem;\r\n    width: 20%;\r\n    width: 2.5rem;\r\n    height: 2.5rem;\r\n    border-radius: 50%;\r\n    background: #f1f1f1;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n  .head {\r\n    width: 1.2rem;\r\n    height: 1.2rem;\r\n  }\r\n  // position: absolute;\r\n  }\r\n  .user-msg {\r\n    width: 80%;\r\n  // position: absolute;\r\n    word-break: break-all;\r\n    position: relative;\r\n    z-index: 5;\r\n  span {\r\n    display: inline-block;\r\n    padding: 0.5rem 0.7rem;\r\n    border-radius: 0.5rem;\r\n    margin-top: 0.2rem;\r\n    font-size: 0.88rem;\r\n  }\r\n  .left {\r\n    background: white;\r\n    animation: toLeft 0.5s ease both 1;\r\n  }\r\n  .right {\r\n    background: #53a8ff;\r\n    color: white;\r\n    animation: toright 0.5s ease both 1;\r\n  }\r\n  @keyframes toLeft {\r\n    0% {\r\n      opacity: 0;\r\n      transform: translateX(-10px);\r\n    }\r\n    100% {\r\n      opacity: 1;\r\n      transform: translateX(0px);\r\n    }\r\n  }\r\n  @keyframes toright {\r\n    0% {\r\n      opacity: 0;\r\n      transform: translateX(10px);\r\n    }\r\n    100% {\r\n      opacity: 1;\r\n      transform: translateX(0px);\r\n    }\r\n  }\r\n  }\r\n  }\r\n  }\r\n  .input-box {\r\n    padding: 0 0.5rem;\r\n    position: absolute;\r\n    bottom: 0;\r\n    width: 100%;\r\n    height: 3.5rem;\r\n    background: #fafafa;\r\n    box-shadow: 0 0 5px #ccc;\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n  input {\r\n    height: 2.3rem;\r\n    display: inline-block;\r\n    width: 100%;\r\n    padding: 0.5rem;\r\n    border: none;\r\n    border-radius: 0.2rem;\r\n    font-size: 0.88rem;\r\n  }\r\n  .btn {\r\n    height: 2.3rem;\r\n    min-width: 4rem;\r\n    background: #e0e0e0;\r\n    padding: 0.5rem;\r\n    font-size: 0.88rem;\r\n    color: white;\r\n    text-align: center;\r\n    border-radius: 0.2rem;\r\n    margin-left: 0.5rem;\r\n    transition: 0.5s;\r\n  }\r\n  .btn-active {\r\n    background: #409eff;\r\n  }\r\n  }\r\n  }\r\n</style>\r\n"]}]}