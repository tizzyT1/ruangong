{"remainingRequest":"D:\\postgraduate\\高中数学课程\\高级软工\\wego\\web\\node_modules\\babel-loader\\lib\\index.js!D:\\postgraduate\\高中数学课程\\高级软工\\wego\\web\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\postgraduate\\高中数学课程\\高级软工\\wego\\web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\postgraduate\\高中数学课程\\高级软工\\wego\\web\\src\\views\\chat.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\postgraduate\\高中数学课程\\高级软工\\wego\\web\\src\\views\\chat.vue","mtime":1697877337559},{"path":"D:\\postgraduate\\高中数学课程\\高级软工\\wego\\web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\postgraduate\\高中数学课程\\高级软工\\wego\\web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\postgraduate\\高中数学课程\\高级软工\\wego\\web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\postgraduate\\高中数学课程\\高级软工\\wego\\web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KZXhwb3J0IGRlZmF1bHQgewogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICB3czogbnVsbCwKICAgICAgY291bnQ6IDAsCiAgICAgIC8vIHVzZXJJZDogdGhpcy4kc3RvcmUuZ2V0dGVycy5pZCwgLy8g5b2T5YmN55So5oi3SUQKICAgICAgLy8gdXNlcm5hbWU6IHRoaXMuJHN0b3JlLmdldHRlcnMubmFtZSwgLy8g5b2T5YmN55So5oi35pi156ewCiAgICAgIC8vIGF2YXRhcjogdGhpcy4kc3RvcmUuZ2V0dGVycy5hdmF0YXIsIC8vIOW9k+WJjeeUqOaIt+WktOWDjwogICAgICBsaXN0OiBbXSwKICAgICAgLy8g6IGK5aSp6K6w5b2V55qE5pWw57uECiAgICAgIGNvbnRlbnRUZXh0OiAiIiwKICAgICAgLy8gaW5wdXTovpPlhaXnmoTlgLwKICAgICAgdXNlcklkOiAwLAogICAgICBteVVzZXJJZDogMAogICAgfTsKICB9LAoKICBtb3VudGVkKCkgewogICAgY29uc29sZS5sb2codGhpcy4kcm91dGUucGFyYW1zKTsKICAgIHRoaXMudXNlcklkID0gdGhpcy4kcm91dGUucGFyYW1zLnVzZXJJZCwgdGhpcy5pbml0V2ViU29ja2V0KCk7CiAgICB0aGlzLm15VXNlcklkID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3VzZXInKTsKICAgIGNvbnNvbGUubG9nKDEyMywgdGhpcy5teVVzZXJJZCk7CiAgfSwKCiAgZGVzdHJveWVkKCkgewogICAgLy8g56a75byA6aG16Z2i5pe25YWz6Zetd2Vic29ja2V06L+e5o6lCiAgICB0aGlzLndzLm9uY2xvc2UodW5kZWZpbmVkKTsKICB9LAoKICBtZXRob2RzOiB7CiAgICAvLyDlj5HpgIHogYrlpKnkv6Hmga8KICAgIHNlbmRUZXh0KCkgewogICAgICBsZXQgX3RoaXMgPSB0aGlzOwoKICAgICAgX3RoaXMuJHJlZnNbInNlbmRNc2ciXS5mb2N1cygpOwoKICAgICAgaWYgKCFfdGhpcy5jb250ZW50VGV4dCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgbGV0IHBhcmFtcyA9IHsKICAgICAgICB0b0lkOiBfdGhpcy51c2VySWQsCiAgICAgICAgbWVzc2FnZUNvbnRlbnQ6IF90aGlzLmNvbnRlbnRUZXh0LAogICAgICAgIGZyb21JZDogX3RoaXMubXlVc2VySWQKICAgICAgfTsKCiAgICAgIF90aGlzLndzLnNlbmQoSlNPTi5zdHJpbmdpZnkocGFyYW1zKSk7IC8v6LCD55SoV2ViU29ja2V0IHNlbmQoKeWPkemAgeS/oeaBr+eahOaWueazlQoKCiAgICAgIF90aGlzLmxpc3QucHVzaChwYXJhbXMpOwoKICAgICAgX3RoaXMuY29udGVudFRleHQgPSAiIjsKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgX3RoaXMuc2Nyb2xsQm90dG0oKTsKICAgICAgfSwgNTAwKTsKICAgIH0sCgogICAgLy8g6L+b5YWl6aG16Z2i5Yib5bu6d2Vic29ja2V06L+e5o6lCiAgICBpbml0V2ViU29ja2V0KCkgewogICAgICBsZXQgX3RoaXMgPSB0aGlzOyAvLyDliKTmlq3pobXpnaLmnInmsqHmnInlrZjlnKh3ZWJzb2NrZXTov57mjqUKCgogICAgICBpZiAod2luZG93LldlYlNvY2tldCkgewogICAgICAgIC8vdmFyIHNlcnZlckhvdCA9ICB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWU7CiAgICAgICAgLy9sZXQgc2lwID0gJ+aIv+mXtOWPtycKICAgICAgICAvLyDloavlhpnmnKzlnLBJUOWcsOWdgCDmraTlpITnmoQgOjkxMDHnq6/lj6Plj7cg6KaB5LiO5ZCO56uv6YWN572u55qE5LiA6Ie077yBCiAgICAgICAgLy92YXIgdXJsID0gJ3dzOi8vJyArIHNlcnZlckhvdCArICc6OTEwMScgKyAnL2dyb3VwQ2hhdC8nICsgc2lwICsgJy8nICsgdGhpcy51c2VySWQ7IC8vIGB3czovLzEyNy4wLjAuMS85MTAxL2dyb3VwQ2hhdC8xMDA4Ni/ogYrlpKnlrqRgCiAgICAgICAgLy90aGlzLndlYnNvY2tldCA9IG5ldyBXZWJTb2NrZXQoYHdzOi8vbG9jYWxob3N0OjgwODEvJHtpZH1gKTsKICAgICAgICBsZXQgdXJsID0gYHdzOi8vbG9jYWxob3N0OjgwODEvY2hhdC8ke190aGlzLnVzZXJJZH1gOwogICAgICAgIGxldCB3cyA9IG5ldyBXZWJTb2NrZXQodXJsKTsKICAgICAgICBfdGhpcy53cyA9IHdzOwoKICAgICAgICB3cy5vbm9wZW4gPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgY29uc29sZS5sb2coIuacjeWKoeWZqOi/nuaOpeaIkOWKnzogIiArIHVybCwgZSk7IC8vd3Muc2VuZChfdGhpcy51c2VySWQpCiAgICAgICAgfTsKCiAgICAgICAgd3Mub25jbG9zZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygi5pyN5Yqh5Zmo6L+e5o6l5YWz6ZetOiAiICsgdXJsLCBlKTsKICAgICAgICB9OwoKICAgICAgICB3cy5vbmVycm9yID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgY29uc29sZS5sb2coIuacjeWKoeWZqOi/nuaOpeWHuumUmTogIiArIHVybCk7CiAgICAgICAgfTsKCiAgICAgICAgd3Mub25tZXNzYWdlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIC8v5o6l5pS25pyN5Yqh5Zmo6L+U5Zue55qE5pWw5o2uCiAgICAgICAgICBsZXQgcmVzRGF0YSA9IEpTT04ucGFyc2UoZS5kYXRhKTsKICAgICAgICAgIGNvbnNvbGUubG9nKCfmjqXmlLbmlbDmja4nLCByZXNEYXRhKTsgLy8gX3RoaXMubGlzdCA9IFsKICAgICAgICAgIC8vICAgLi4uX3RoaXMubGlzdCwKICAgICAgICAgIC8vICAgeyB1c2VySWQ6IHJlc0RhdGEudXNlcklkLCB1c2VybmFtZTogcmVzRGF0YS51c2VybmFtZSwgYXZhdGFyOiByZXNEYXRhLmF2YXRhciwgY29udGVudDogcmVzRGF0YS5tc2cgfQogICAgICAgICAgLy8gXTsKCiAgICAgICAgICBfdGhpcy5saXN0LnB1c2gocmVzRGF0YSk7CgogICAgICAgICAgY29uc29sZS5sb2coJ+a2iOaBr+WIl+ihqCcsIF90aGlzLmxpc3QpOwogICAgICAgIH07CiAgICAgIH0KICAgIH0sCgogICAgLy8g5rua5Yqo5p2h5Yiw5bqV6YOoCiAgICBzY3JvbGxCb3R0bSgpIHsKICAgICAgbGV0IGVsID0gdGhpcy4kcmVmc1sibXNnLWJveCJdOwogICAgICBlbC5zY3JvbGxUb3AgPSBlbC5zY3JvbGxIZWlnaHQ7CiAgICB9CgogIH0KfTs="},{"version":3,"sources":["chat.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <div class=\"chat-box\">\r\n    <header>与{{userId}}聊天</header>\r\n    <div class=\"msg-box\" ref=\"msg-box\">\r\n      <div\r\n        v-for=\"(i,index) in list\"\r\n        :key=\"index\"\r\n        class=\"msg\"\r\n        \r\n      >\r\n        <!-- <div class=\"user-head\">\r\n          <img :src=\"i.avatar\" height=\"30\" width=\"30\" :title=\"i.username\">\r\n        </div> -->\r\n        <div class=\"user-msg\">\r\n          <span :style=\"i.toId == userId?' float: right;':''\" :class=\"i.toId == userId?'right':'left'\">{{i.messageContent}}</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"input-box\">\r\n      <input type=\"text\" ref=\"sendMsg\" v-model=\"contentText\" @keyup.enter=\"sendText()\" />\r\n      <div class=\"btn\" :class=\"{['btn-active']:contentText}\" @click=\"sendText()\">发送</div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  export default {\r\n    data() {\r\n      return {\r\n        ws: null,\r\n        count: 0,\r\n        // userId: this.$store.getters.id, // 当前用户ID\r\n        // username: this.$store.getters.name, // 当前用户昵称\r\n        // avatar: this.$store.getters.avatar, // 当前用户头像\r\n        list: [], // 聊天记录的数组\r\n        contentText: \"\", // input输入的值\r\n        userId: 0,\r\n        myUserId: 0\r\n      };\r\n    },\r\n    mounted() {\r\n        console.log(this.$route.params)\r\n        this.userId = this.$route.params.userId,\r\n        this.initWebSocket();\r\n        this.myUserId = localStorage.getItem('user')\r\n        console.log(123,this.myUserId)\r\n    },\r\n\r\n    destroyed() {\r\n      // 离开页面时关闭websocket连接\r\n      this.ws.onclose(undefined);\r\n    },\r\n    methods: {\r\n      // 发送聊天信息\r\n      sendText() {\r\n        let _this = this;\r\n        _this.$refs[\"sendMsg\"].focus();\r\n        if (!_this.contentText) {\r\n          return;\r\n        }\r\n        let params = {\r\n          toId: _this.userId,\r\n          messageContent: _this.contentText,\r\n          fromId: _this.myUserId,\r\n        };\r\n        _this.ws.send(JSON.stringify(params)); //调用WebSocket send()发送信息的方法\r\n        _this.list.push(params)\r\n        _this.contentText = \"\";\r\n        setTimeout(() => {\r\n          _this.scrollBottm();\r\n        }, 500);\r\n      },\r\n      // 进入页面创建websocket连接\r\n      initWebSocket() {\r\n        let _this = this;\r\n        // 判断页面有没有存在websocket连接\r\n        if (window.WebSocket) {\r\n          //var serverHot =  window.location.hostname;\r\n          //let sip = '房间号'\r\n          // 填写本地IP地址 此处的 :9101端口号 要与后端配置的一致！\r\n          //var url = 'ws://' + serverHot + ':9101' + '/groupChat/' + sip + '/' + this.userId; // `ws://127.0.0.1/9101/groupChat/10086/聊天室`\r\n          //this.websocket = new WebSocket(`ws://localhost:8081/${id}`);\r\n          let url = `ws://localhost:8081/chat/${_this.userId}`;\r\n          let ws = new WebSocket(url);\r\n          _this.ws = ws;\r\n          ws.onopen = function(e) {\r\n            console.log(\"服务器连接成功: \" + url,e);\r\n            //ws.send(_this.userId)\r\n          };\r\n          ws.onclose = function(e) {\r\n            console.log(\"服务器连接关闭: \" + url,e);\r\n          };\r\n          ws.onerror = function() {\r\n            console.log(\"服务器连接出错: \" + url);\r\n          };\r\n          ws.onmessage = function(e) {\r\n            //接收服务器返回的数据\r\n            let resData = JSON.parse(e.data)\r\n            console.log('接收数据',resData)\r\n            // _this.list = [\r\n            //   ..._this.list,\r\n            //   { userId: resData.userId, username: resData.username, avatar: resData.avatar, content: resData.msg }\r\n            // ];\r\n            _this.list.push(resData)\r\n            console.log('消息列表',_this.list)\r\n          };\r\n        }\r\n      },\r\n      // 滚动条到底部\r\n      scrollBottm() {\r\n          let el = this.$refs[\"msg-box\"];\r\n          el.scrollTop = el.scrollHeight;\r\n      }\r\n    }\r\n  };\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n  .chat-box {\r\n    margin: 0 auto;\r\n    background: #fafafa;\r\n    position: absolute;\r\n    height: 100%;\r\n    width: 100%;\r\n    max-width: 700px;\r\n  header {\r\n    position: fixed;\r\n    width: 100%;\r\n    height: 3rem;\r\n    background: #409eff;\r\n    max-width: 700px;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    font-weight: bold;\r\n    color: white;\r\n    font-size: 1rem;\r\n  }\r\n  .msg-box {\r\n    position: absolute;\r\n    height: calc(100% - 6.5rem);\r\n    width: 100%;\r\n    margin-top: 3rem;\r\n    overflow-y: scroll;\r\n  .msg {\r\n    width: 95%;\r\n    min-height: 2.5rem;\r\n    margin: 1rem 0.5rem;\r\n    position: relative;\r\n    display: flex;\r\n    justify-content: flex-start !important;\r\n  .user-head {\r\n    min-width: 2.5rem;\r\n    width: 20%;\r\n    width: 2.5rem;\r\n    height: 2.5rem;\r\n    border-radius: 50%;\r\n    background: #f1f1f1;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n  .head {\r\n    width: 1.2rem;\r\n    height: 1.2rem;\r\n  }\r\n  // position: absolute;\r\n  }\r\n  .user-msg {\r\n    width: 80%;\r\n  // position: absolute;\r\n    word-break: break-all;\r\n    position: relative;\r\n    z-index: 5;\r\n  span {\r\n    display: inline-block;\r\n    padding: 0.5rem 0.7rem;\r\n    border-radius: 0.5rem;\r\n    margin-top: 0.2rem;\r\n    font-size: 0.88rem;\r\n  }\r\n  .left {\r\n    background: white;\r\n    animation: toLeft 0.5s ease both 1;\r\n  }\r\n  .right {\r\n    background: #53a8ff;\r\n    color: white;\r\n    animation: toright 0.5s ease both 1;\r\n  }\r\n  @keyframes toLeft {\r\n    0% {\r\n      opacity: 0;\r\n      transform: translateX(-10px);\r\n    }\r\n    100% {\r\n      opacity: 1;\r\n      transform: translateX(0px);\r\n    }\r\n  }\r\n  @keyframes toright {\r\n    0% {\r\n      opacity: 0;\r\n      transform: translateX(10px);\r\n    }\r\n    100% {\r\n      opacity: 1;\r\n      transform: translateX(0px);\r\n    }\r\n  }\r\n  }\r\n  }\r\n  }\r\n  .input-box {\r\n    padding: 0 0.5rem;\r\n    position: absolute;\r\n    bottom: 0;\r\n    width: 100%;\r\n    height: 3.5rem;\r\n    background: #fafafa;\r\n    box-shadow: 0 0 5px #ccc;\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n  input {\r\n    height: 2.3rem;\r\n    display: inline-block;\r\n    width: 100%;\r\n    padding: 0.5rem;\r\n    border: none;\r\n    border-radius: 0.2rem;\r\n    font-size: 0.88rem;\r\n  }\r\n  .btn {\r\n    height: 2.3rem;\r\n    min-width: 4rem;\r\n    background: #e0e0e0;\r\n    padding: 0.5rem;\r\n    font-size: 0.88rem;\r\n    color: white;\r\n    text-align: center;\r\n    border-radius: 0.2rem;\r\n    margin-left: 0.5rem;\r\n    transition: 0.5s;\r\n  }\r\n  .btn-active {\r\n    background: #409eff;\r\n  }\r\n  }\r\n  }\r\n</style>\r\n"],"sourceRoot":"src/views"}]}